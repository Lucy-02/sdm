import { PrismaClient, UserRole, SimulationStatus, VendorImageType, BookingStatus } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('ðŸŒ± Starting seed...');

  // Clean existing data
  console.log('ðŸ§¹ Cleaning existing data...');
  await prisma.favorite.deleteMany();
  await prisma.review.deleteMany();
  await prisma.booking.deleteMany();
  await prisma.vendorTag.deleteMany();
  await prisma.tag.deleteMany();
  await prisma.vendorImage.deleteMany();
  await prisma.vendor.deleteMany();
  await prisma.vendorCategory.deleteMany();
  await prisma.simulationResult.deleteMany();
  await prisma.user.deleteMany();

  // 1. Create Users (20 users)
  console.log('ðŸ‘¤ Creating users...');
  const users: any[] = [];
  for (let i = 1; i <= 20; i++) {
    const user = await prisma.user.create({
      data: {
        email: `user${i}@example.com`,
        name: `ì‚¬ìš©ìž${i}`,
        phone: `010-${String(1000 + i).padStart(4, '0')}-${String(5000 + i).padStart(4, '0')}`,
        password: 'hashed_password_here',
        role: i <= 15 ? UserRole.CUSTOMER : UserRole.VENDOR,
        emailVerified: i % 3 !== 0,
        isActive: true,
      },
    });
    users.push(user);
  }
  console.log(`âœ… Created ${users.length} users`);

  // 2. Create Vendor Categories
  console.log('ðŸ“ Creating vendor categories...');
  const categories = await Promise.all([
    prisma.vendorCategory.create({
      data: {
        slug: 'studio',
        name: 'ìŠ¤íŠœë””ì˜¤',
        description: 'ì›¨ë”© ì´¬ì˜ ì „ë¬¸ ìŠ¤íŠœë””ì˜¤',
        icon: 'ðŸ“¸',
        displayOrder: 1,
        isActive: true,
      },
    }),
    prisma.vendorCategory.create({
      data: {
        slug: 'makeup',
        name: 'ë©”ì´í¬ì—…',
        description: 'ì›¨ë”© ë©”ì´í¬ì—… ë° í—¤ì–´',
        icon: 'ðŸ’„',
        displayOrder: 2,
        isActive: true,
      },
    }),
    prisma.vendorCategory.create({
      data: {
        slug: 'dress',
        name: 'ë“œë ˆìŠ¤',
        description: 'ì›¨ë”©ë“œë ˆìŠ¤ ë° ì˜ˆë³µ',
        icon: 'ðŸ‘—',
        displayOrder: 3,
        isActive: true,
      },
    }),
    prisma.vendorCategory.create({
      data: {
        slug: 'venue',
        name: 'ì˜ˆì‹ìž¥',
        description: 'ì›¨ë”©í™€ ë° ì˜ˆì‹ìž¥',
        icon: 'ðŸ›ï¸',
        displayOrder: 4,
        isActive: true,
      },
    }),
    prisma.vendorCategory.create({
      data: {
        slug: 'car',
        name: 'ì›¨ë”©ì¹´',
        description: 'ì›¨ë”© ì „ìš© ì°¨ëŸ‰',
        icon: 'ðŸš—',
        displayOrder: 5,
        isActive: true,
      },
    }),
  ]);
  console.log(`âœ… Created ${categories.length} categories`);

  // 3. Create Tags (15 tags)
  console.log('ðŸ·ï¸ Creating tags...');
  const tagData = [
    { name: 'ì•¼ì™¸ì´¬ì˜', slug: 'outdoor', categoryId: categories[0].id },
    { name: 'ìŠ¤ëƒ…ì´¬ì˜', slug: 'snap', categoryId: categories[0].id },
    { name: 'ë³¸ì‹ì´¬ì˜', slug: 'ceremony', categoryId: categories[0].id },
    { name: 'í•œë³µë©”ì´í¬ì—…', slug: 'hanbok-makeup', categoryId: categories[1].id },
    { name: 'ì›¨ë”©ë©”ì´í¬ì—…', slug: 'wedding-makeup', categoryId: categories[1].id },
    { name: 'ì—ì–´ë¸ŒëŸ¬ì‹œ', slug: 'airbrush', categoryId: categories[1].id },
    { name: 'ë§žì¶¤ì œìž‘', slug: 'custom-made', categoryId: categories[2].id },
    { name: 'ìž„ëŒ€ë“œë ˆìŠ¤', slug: 'rental', categoryId: categories[2].id },
    { name: 'í•œë³µ', slug: 'hanbok', categoryId: categories[2].id },
    { name: 'ì±„í”Œ', slug: 'chapel', categoryId: categories[3].id },
    { name: 'ì•¼ì™¸ì •ì›', slug: 'garden', categoryId: categories[3].id },
    { name: 'í˜¸í…”', slug: 'hotel', categoryId: categories[3].id },
    { name: 'í´ëž˜ì‹ì¹´', slug: 'classic-car', categoryId: categories[4].id },
    { name: 'ë¦¬ë¬´ì§„', slug: 'limousine', categoryId: categories[4].id },
    { name: 'ë²¤ì¸ ', slug: 'benz', categoryId: categories[4].id },
  ];
  const tags = await Promise.all(
    tagData.map((tag) =>
      prisma.tag.create({
        data: tag,
      })
    )
  );
  console.log(`âœ… Created ${tags.length} tags`);

  // 4. Create Vendors (20 vendors, 4 per category)
  console.log('ðŸ¢ Creating vendors...');
  const vendors: any[] = [];
  const vendorOwners = users.filter((u: any) => u.role === UserRole.VENDOR);

  for (let catIdx = 0; catIdx < categories.length; catIdx++) {
    const category = categories[catIdx];
    for (let i = 1; i <= 4; i++) {
      const vendorNum = catIdx * 4 + i;
      const vendor = await prisma.vendor.create({
        data: {
          categoryId: category.id,
          ownerId: vendorOwners[vendorNum % vendorOwners.length]?.id,
          name: `${category.name} ${vendorNum}í˜¸ì `,
          slug: `${category.slug}-${vendorNum}`,
          description: `${category.name} ì „ë¬¸ ì—…ì²´ìž…ë‹ˆë‹¤. ìµœê³ ì˜ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`,
          phone: `02-${String(1000 + vendorNum).padStart(4, '0')}-${String(5000 + vendorNum).padStart(4, '0')}`,
          email: `${category.slug}${i}@example.com`,
          website: `https://${category.slug}${i}.example.com`,
          location: ['ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬', 'ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬', 'ê²½ê¸°ë„ ì„±ë‚¨ì‹œ', 'ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬'][i % 4],
          lat: 37.4 + (i * 0.05),
          lng: 127.0 + (i * 0.05),
          priceRange: `${i * 50}ë§Œì›~${i * 100}ë§Œì›`,
          priceMin: i * 50,
          priceMax: i * 100,
          businessHours: {
            mon: '09:00-18:00',
            tue: '09:00-18:00',
            wed: '09:00-18:00',
            thu: '09:00-18:00',
            fri: '09:00-18:00',
            sat: '09:00-20:00',
            sun: '10:00-17:00',
          },
          metadata: category.slug === 'studio' ? {
            studioSize: `${100 + i * 50}í‰`,
            equipments: ['4Kì¹´ë©”ë¼', 'ì¡°ëª…ìž¥ë¹„', 'ë°°ê²½ì„¸íŠ¸'],
          } : category.slug === 'venue' ? {
            capacity: 200 + i * 100,
            parkingSpots: 50 + i * 20,
            hasChapel: i % 2 === 0,
          } : {},
          rating: 4.0 + (i * 0.2),
          reviewCount: i * 10,
          bookingCount: i * 5,
          favoriteCount: i * 8,
          viewCount: i * 100,
          isVerified: i <= 2,
          isActive: true,
          isPremium: i === 1,
        },
      });
      vendors.push(vendor);
    }
  }
  console.log(`âœ… Created ${vendors.length} vendors`);

  // 5. Create Vendor Images (3-5 images per vendor)
  console.log('ðŸ–¼ï¸ Creating vendor images...');
  let imageCount = 0;
  for (const vendor of vendors) {
    const numImages = 3 + Math.floor(Math.random() * 3);
    for (let i = 0; i < numImages; i++) {
      await prisma.vendorImage.create({
        data: {
          vendorId: vendor.id,
          url: `https://picsum.photos/seed/${vendor.id}-${i}/800/600`,
          type: i === 0 ? VendorImageType.THUMBNAIL : VendorImageType.PORTFOLIO,
          displayOrder: i,
          altText: `${vendor.name} ì‚¬ì§„ ${i + 1}`,
        },
      });
      imageCount++;
    }
  }
  console.log(`âœ… Created ${imageCount} vendor images`);

  // 6. Create Vendor Tags (2-4 tags per vendor)
  console.log('ðŸ”— Creating vendor tags...');
  let vendorTagCount = 0;
  for (const vendor of vendors) {
    const categoryTags = tags.filter((t) => t.categoryId === vendor.categoryId);
    const numTags = Math.min(2 + Math.floor(Math.random() * 3), categoryTags.length);
    const selectedTags = categoryTags.slice(0, numTags);

    for (const tag of selectedTags) {
      await prisma.vendorTag.create({
        data: {
          vendorId: vendor.id,
          tagId: tag.id,
        },
      });
      vendorTagCount++;
    }
  }
  console.log(`âœ… Created ${vendorTagCount} vendor tags`);

  // 7. Create Simulation Results (15 results)
  console.log('ðŸŽ¨ Creating simulation results...');
  const customerUsers = users.filter((u: any) => u.role === UserRole.CUSTOMER);
  const simulations: any[] = [];
  for (let i = 0; i < 15; i++) {
    const status = [
      SimulationStatus.COMPLETED,
      SimulationStatus.COMPLETED,
      SimulationStatus.COMPLETED,
      SimulationStatus.PROCESSING,
      SimulationStatus.PENDING,
    ][i % 5];

    const simulation = await prisma.simulationResult.create({
      data: {
        userId: customerUsers[i % customerUsers.length].id,
        groomImageUrl: `https://i.pravatar.cc/300?img=${i + 10}`,
        brideImageUrl: `https://i.pravatar.cc/300?img=${i + 30}`,
        outputImageUrl: status === SimulationStatus.COMPLETED
          ? `https://picsum.photos/seed/wedding-${i}/1200/800`
          : null,
        status: status,
        concept: ['classic', 'modern', 'outdoor', 'vintage'][i % 4],
        metadata: {
          processingTime: status === SimulationStatus.COMPLETED ? 45000 + i * 1000 : null,
          modelVersion: 'v2.1',
        },
        completedAt: status === SimulationStatus.COMPLETED ? new Date(Date.now() - i * 86400000) : null,
      },
    });
    simulations.push(simulation);
  }
  console.log(`âœ… Created ${simulations.length} simulation results`);

  // 8. Create Bookings (20 bookings)
  console.log('ðŸ“… Creating bookings...');
  const bookings: any[] = [];
  for (let i = 0; i < 20; i++) {
    const status = [
      BookingStatus.CONFIRMED,
      BookingStatus.CONFIRMED,
      BookingStatus.PENDING,
      BookingStatus.COMPLETED,
      BookingStatus.CANCELLED,
    ][i % 5];

    const booking = await prisma.booking.create({
      data: {
        vendorId: vendors[i % vendors.length].id,
        userId: customerUsers[i % customerUsers.length].id,
        status: status,
        eventDate: new Date(Date.now() + (i * 7 + 30) * 86400000),
        guestCount: 100 + i * 20,
        budget: 200 + i * 50,
        message: `ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤. ${i + 1}ë²ˆì§¸ ì˜ˆì•½ìž…ë‹ˆë‹¤.`,
        vendorResponse: status !== BookingStatus.PENDING ? `ë‹µë³€ë“œë¦½ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.` : null,
        metadata: {
          shootingDate: new Date(Date.now() + (i * 7 + 20) * 86400000).toISOString(),
        },
        confirmedAt: (status === BookingStatus.CONFIRMED || status === BookingStatus.COMPLETED)
          ? new Date(Date.now() - i * 86400000)
          : null,
        completedAt: status === BookingStatus.COMPLETED
          ? new Date(Date.now() - i * 3600000)
          : null,
      },
    });
    bookings.push(booking);
  }
  console.log(`âœ… Created ${bookings.length} bookings`);

  // 9. Create Reviews (15 reviews for completed bookings)
  console.log('â­ Creating reviews...');
  const completedBookings = bookings.filter((b: any) => b.status === BookingStatus.COMPLETED);
  const reviews: any[] = [];
  for (let i = 0; i < Math.min(15, completedBookings.length * 2); i++) {
    const booking = completedBookings[i % completedBookings.length];
    const review = await prisma.review.create({
      data: {
        vendorId: booking.vendorId,
        userId: booking.userId,
        bookingId: i < completedBookings.length ? booking.id : null,
        rating: 3 + Math.floor(Math.random() * 3),
        title: `ì •ë§ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ì„œë¹„ìŠ¤ì˜€ìŠµë‹ˆë‹¤ ${i + 1}`,
        content: `ì¹œì ˆí•˜ê³  ì „ë¬¸ì ì¸ ì„œë¹„ìŠ¤ì— ë§¤ìš° ë§Œì¡±í–ˆìŠµë‹ˆë‹¤. ê²°í˜¼ ì¤€ë¹„í•˜ì‹œëŠ” ë¶„ë“¤ê»˜ ê°•ë ¥ ì¶”ì²œí•©ë‹ˆë‹¤!`,
        images: [
          `https://picsum.photos/seed/review-${i}-1/400/300`,
          `https://picsum.photos/seed/review-${i}-2/400/300`,
        ],
        isVerified: i % 3 !== 0,
        response: i % 2 === 0 ? `ê°ì‚¬í•©ë‹ˆë‹¤. ì•žìœ¼ë¡œë„ ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤.` : null,
        respondedAt: i % 2 === 0 ? new Date(Date.now() - i * 3600000) : null,
      },
    });
    reviews.push(review);
  }
  console.log(`âœ… Created ${reviews.length} reviews`);

  // 10. Create Favorites (20 favorites)
  console.log('â¤ï¸ Creating favorites...');
  const favorites: any[] = [];
  for (let i = 0; i < 20; i++) {
    const favorite = await prisma.favorite.create({
      data: {
        userId: customerUsers[i % customerUsers.length].id,
        vendorId: vendors[i % vendors.length].id,
      },
    });
    favorites.push(favorite);
  }
  console.log(`âœ… Created ${favorites.length} favorites`);

  console.log('');
  console.log('ðŸŽ‰ Seed completed successfully!');
  console.log('');
  console.log('ðŸ“Š Summary:');
  console.log(`   - Users: ${users.length}`);
  console.log(`   - Categories: ${categories.length}`);
  console.log(`   - Tags: ${tags.length}`);
  console.log(`   - Vendors: ${vendors.length}`);
  console.log(`   - Vendor Images: ${imageCount}`);
  console.log(`   - Vendor Tags: ${vendorTagCount}`);
  console.log(`   - Simulation Results: ${simulations.length}`);
  console.log(`   - Bookings: ${bookings.length}`);
  console.log(`   - Reviews: ${reviews.length}`);
  console.log(`   - Favorites: ${favorites.length}`);
}

main()
  .catch((e) => {
    console.error('âŒ Error during seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
