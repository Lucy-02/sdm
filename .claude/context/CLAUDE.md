# Context 관리 가이드

## 📍 디렉토리 목적

`context/` 디렉토리는 작업의 현재 상태와 문서 인덱싱을 관리하는 중추입니다.
- **current.md**: 실시간 작업 상태 추적
- **index.md**: Global numbering 관리 및 모든 문서 인덱싱
- **dialog/**: 대화 로그 보관

## 📄 current.md - 작업 연속성의 핵심

### 목적
- Context Compact 후에도 작업 연속성 보장
- 실시간 작업 상태 동기화
- 세션 간 원활한 전환

### 업데이트 시점 (필수)
- ✅ 새 작업 시작 시
- ✅ 각 하위 작업 완료 직후
- ✅ 파일 생성/수정/삭제 직후
- ✅ 중요한 결정 직후
- ✅ 차단 요소 발견 시
- ✅ 세션 종료 전

### current.md 구조

```markdown
# 현재 작업 세션

## 세션 정보
- 시작: [날짜시간]
- 마지막 업데이트: [날짜시간]
- 작업 목적: [간략한 설명]

## 활성 작업
- 작업명: [진행 중인 작업]
- 현재 단계: [계획/할일/구현/검토]
- 진행률: [X/Y 하위작업 완료]

## 현재 상태

### 작업 위치
- 파일: [정확한 파일 경로]
- 함수/클래스: [작업 중인 코드 위치]
- 마지막 완료: [방금 끝낸 작업]
- 다음 작업: [바로 다음 할 작업]

### 파일 변경
- 생성: [새로 만든 파일들]
- 수정: [변경한 파일들]
- 삭제: [제거한 파일들]

## 활성 문서
- 계획: [numbered plan 파일]
- 할일: [numbered todo 파일]
- 관련 DKB: [참조 중인 지식]

## 차단 요소
- [차단 사항 및 dev_action 참조]

## 다음 단계
1. [즉시 할 작업]
2. [그 다음 작업]
```

## 📂 dialog/ 디렉토리 - 대화 로그

- **형식**: `YYYYMMDD_NNN_dialog.md`
  - YYYYMMDD: 날짜
  - NNN: 당일 순번 (001부터)
- **내용**: 사용자와 Claude 간 대화 원문
- **편집 금지**: 원본 그대로 보존

## 📑 index.md - 브랜치 기반 Global Numbering

### 파일명 형식
```
{branch}_{number}_{name}_{type}.md
예: master_001_initial_setup_plan.md
예: feature-auth_001_jwt_implementation_todo.md
```

### index.md 구조
```markdown
# Global Numbering Index (브랜치 기반)

## 🌿 브랜치별 번호 현황

### [master]
다음 번호: 004

| 번호 | 파일명 | 위치 | 생성일시 | 설명 |
|------|--------|------|----------|------|
| 001 | master_001_initial_setup_plan.md | docs/plan/ | 2024-11-28 10:00 | 초기 설정 계획 |
| 002 | master_002_auth_todo.md | docs/todo/ | 2024-11-28 10:30 | 인증 할일 |
| 003 | master_003_db_structure.md | docs/structure/ | 2024-11-28 11:00 | DB 구조 문서 |

### [feature-auth]
다음 번호: 002

| 번호 | 파일명 | 위치 | 생성일시 | 설명 |
|------|--------|------|----------|------|
| 001 | feature-auth_001_jwt_todo.md | docs/todo/ | 2024-11-28 14:00 | JWT 구현 |

---
## 삭제된 파일
...
```

### 핵심 규칙
- 각 브랜치는 독립적인 001부터 시작하는 번호 체계
- Merge 시 브랜치 섹션 각각 보존
- 파일명에 브랜치 prefix로 충돌 방지

## ⚡ 실시간 동기화 프로토콜

### 작업 시작
1. current.md 읽기/생성
2. 세션 정보 업데이트
3. 이전 상태 확인

### 작업 중
```
매 작업 단위마다:
1. 작업 완료
2. current.md 즉시 업데이트
3. 다음 작업 진행
```

### 작업 종료
1. 최종 상태 저장
2. 다음 단계 명시
3. 미완료 사항 기록

## ❌ 주의사항

### 절대 하지 말 것
- ❌ current.md 업데이트 지연
- ❌ 여러 작업 후 일괄 업데이트
- ❌ dialog 파일 편집
- ❌ index.md의 번호 재사용

### 반드시 할 것
- ✅ 매 작업마다 즉시 동기화
- ✅ 정확한 파일 경로 기록
- ✅ 시간 정보 포함 (**Time MCP 사용 필수**)
- ✅ 번호 순차 할당

## 🕐 Time MCP 사용 규칙

**⚠️ 모든 timestamp 기록 시 반드시 `mcp__time__get_current_time` 도구를 사용하세요.**

### 필수 사용 상황
- current.md 업데이트 시 (`마지막 업데이트: `)
- dialog 로그 생성 시 (`시간: `)
- index.md 문서 등록 시 (`생성일시: `)
- 세션 시작/종료 기록 시

### 사용 방법
```
1. mcp__time__get_current_time 호출
2. 반환된 시간을 문서에 기록
3. 형식: YYYY-MM-DD HH:MM:SS
```

### ❌ 금지 사항
- 시스템 시간 추측 금지
- 이전 시간 재사용 금지
- Time MCP 없이 timestamp 작성 금지